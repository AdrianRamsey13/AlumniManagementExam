@model IEnumerable<AlumniManagement.JobHistoryService.JobHistoryDTO>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.1.7/css/fixedHeader.dataTables.min.css">
    <style>
        .table-container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }

        #jobData {
            width: 100% !important;
            table-layout: auto;
        }

            #jobData th, #jobData td {
                white-space: nowrap;
                text-align: center;
            }
    </style>
}

<h2>Index</h2>

<button class="btn ">
    @*<a href="/JobHistory/Create?AlumniID=' + alumniID +'" class="btn btn-primary">Create Job</a>*@
    <form action="@Url.Action("Create", "JobHistory")" method="get">
        <input type="hidden" name="alumniID" value="@ViewBag.AlumniID" />
        <button type="submit" class="btn btn-primary">Create</button>
    </form>
</button>

<button id="deleteSelected" class="btn btn-danger">Delete Selected</button>

<div class="table-container">
    <table class="table table-striped table-bordered" id="alumniData">
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll" /></th>
                <th>Actions</th>
                <th>No.</th>
                <th>Full Name</th>
                <th>Email</th>
                <th>Mobile Number</th>
                <th>Address</th>
                <th>Graduation Year</th>
                <th>Degree</th>
                <th>Major Name</th>
                <th>Faculty Name</th>
                <th>Last Update</th>
            </tr>
        </thead>
    </table>

    @*Create Modal*@
    <div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="createModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createModalLabel">Create New Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Form Starts Here -->
                    @using (Html.BeginForm("Create", "Alumni", FormMethod.Post, new { id = "createForm" }))
                    {
                        @Html.AntiForgeryToken()

                        //Template location
                        <div class="form-horizontal">
                            <h4>AlumniDTO</h4>
                            <hr />

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Create</button>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    @*-----------*@
    @*Edit Modal*@
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Room</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    @using (Html.BeginForm("Edit", "Alumni", FormMethod.Post, new { id = "editForm" }))
                    {
                        @Html.AntiForgeryToken()
                        //Template Edit
                        <div class="form-horizontal">
                            <h4>AlumniDTO</h4>
                            <hr />

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Create</button>
                            </div>

                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

</div>

@section Scripts{
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.1.7/js/dataTables.fixedHeader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script>
        $(document).ready(function () {
            var table = $('#jobData').DataTable({
                "ajax": {
                    "url": "/JobHistory/GetJobHistories",
                    "type": "GET",
                    "datatype": "json"
                },
                "columns": [
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            return '<input type="checkbox" class="checkbox" data-id="' + data + '">';
                        }
                    },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            var editLink = '@Url.Action("Edit", "JobHistory", new { id = "PLACEHOLDER"})'.replace("PLACEHOLDER", row.AlumniID);
                            ////var jobLink = '@Url.Action("Index", "JobHistory", new { alumniId = "PLACEHOLDER"})'.replace("PLACEHOLDER", row.AlumniID);
                            return '<div style="display: flex; gap: 5px;">' +
                                '<a href="javascript:void(0);" class="btn btn-primary" data-id="' + row.AlumniID + '" id="editButton">Edit</a>' +
                                '<button class="btn btn-danger deleteButton" data-id="' + row.AlumniID + '">Delete</button>' +
                                '</div>';
                    }
                    },
                    {
                        "data": null,
                        "render": function (data, type, row, meta) {
                            return meta.row + 1;
                        }
                    },
                    { "data": "FullName" },
                    { "data": "Email" },
                    { "data": "MobileNumber" },
                    { "data": "Address" },
                    { "data": "GraduationYear" },
                    { "data": "Degree" },
                    { "data": "MajorName" },
                    { "data": "FacultyName" },
                    {
                        "data": "LastUpdate",
                        "render": function (data) {
                            return moment(data).format('DD/MM/YYYY HH:mm:ss');
                        }
                    }
                ],
                "order": [[1, 'asc']],
                "fixedHeader": true
            });
            $('#selectAll').on('click', function () {
                if (this.checked) {
                    $('.checkbox').each(function () {
                        this.checked = true;
                    });
                } else {
                    $('.checkbox').each(function () {
                        this.checked = false;
                    });
                }
            });
            $('#deleteSelected').on('click', function () {
                var selected = [];
                $('.checkbox:checked').each(function () {
                    selected.push($(this).attr('data-id'));
                });
                if (selected.length > 0) {
                    Swal.fire({
                        title: 'Are you sure?',
                        text: 'You will not be able to recover this data!',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#
        })
    </script>
}
